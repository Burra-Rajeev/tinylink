{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20project/tinylink/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\ndeclare global {\r\n    // allow global prisma in dev to avoid creating multiple instances\r\n    var prisma: PrismaClient | undefined;\r\n}\r\n\r\nconst prisma = global.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") global.prisma = prisma;\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAOA,MAAM,SAAS,OAAO,MAAM,IAAI,IAAI,6IAAY;AAEhD,wCAA2C,OAAO,MAAM,GAAG;uCAE5C"}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20project/tinylink/pages/api/links/index.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport prisma from \"../../../lib/prisma\";\r\nimport validUrl from \"valid-url\";\r\n\r\nconst CODE_REGEX = /^[A-Za-z0-9]{6,8}$/;\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n    if (req.method === \"GET\") {\r\n        const links = await prisma.link.findMany({ orderBy: { createdAt: \"desc\" } });\r\n        return res.status(200).json(links);\r\n    }\r\n\r\n    if (req.method === \"POST\") {\r\n        const body = req.body || {};\r\n        const url = (body.url || \"\").toString().trim();\r\n        const customCode = (body.code || \"\").toString().trim();\r\n\r\n        if (!url || !validUrl.isWebUri(url)) {\r\n            return res.status(400).json({ error: \"Invalid or missing URL\" });\r\n        }\r\n\r\n        let code = customCode;\r\n\r\n        if (code) {\r\n            if (!CODE_REGEX.test(code)) {\r\n                return res.status(400).json({ error: \"Custom code must match [A-Za-z0-9]{6,8}\" });\r\n            }\r\n            const exists = await prisma.link.findUnique({ where: { code } });\r\n            if (exists) return res.status(409).json({ error: \"Code already exists\" });\r\n        } else {\r\n            const generate = () => {\r\n                const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n                let s = \"\";\r\n                for (let i = 0; i < 6; i++) s += chars[Math.floor(Math.random() * chars.length)];\r\n                return s;\r\n            };\r\n\r\n            let attempts = 0;\r\n            do {\r\n                code = generate();\r\n                const exists = await prisma.link.findUnique({ where: { code } });\r\n                if (!exists) break;\r\n                attempts++;\r\n            } while (attempts < 5);\r\n        }\r\n\r\n        const created = await prisma.link.create({\r\n            data: {\r\n                code,\r\n                url,\r\n            },\r\n        });\r\n\r\n        return res.status(201).json(created);\r\n    }\r\n\r\n    res.setHeader(\"Allow\", [\"GET\", \"POST\"]);\r\n    return res.status(405).end(\"Method Not Allowed\");\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEA,MAAM,aAAa;AAEJ,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC3E,IAAI,IAAI,MAAM,KAAK,OAAO;QACtB,MAAM,QAAQ,MAAM,iHAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YAAE,SAAS;gBAAE,WAAW;YAAO;QAAE;QAC1E,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAChC;IAEA,IAAI,IAAI,MAAM,KAAK,QAAQ;QACvB,MAAM,OAAO,IAAI,IAAI,IAAI,CAAC;QAC1B,MAAM,MAAM,CAAC,KAAK,GAAG,IAAI,EAAE,EAAE,QAAQ,GAAG,IAAI;QAC5C,MAAM,aAAa,CAAC,KAAK,IAAI,IAAI,EAAE,EAAE,QAAQ,GAAG,IAAI;QAEpD,IAAI,CAAC,OAAO,CAAC,4HAAQ,CAAC,QAAQ,CAAC,MAAM;YACjC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAyB;QAClE;QAEA,IAAI,OAAO;QAEX,IAAI,MAAM;YACN,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO;gBACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAA0C;YACnF;YACA,MAAM,SAAS,MAAM,iHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE;gBAAK;YAAE;YAC9D,IAAI,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAsB;QAC3E,OAAO;YACH,MAAM,WAAW;gBACb,MAAM,QAAQ;gBACd,IAAI,IAAI;gBACR,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM,EAAE;gBAChF,OAAO;YACX;YAEA,IAAI,WAAW;YACf,GAAG;gBACC,OAAO;gBACP,MAAM,SAAS,MAAM,iHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE;oBAAK;gBAAE;gBAC9D,IAAI,CAAC,QAAQ;gBACb;YACJ,QAAS,WAAW,EAAG;QAC3B;QAEA,MAAM,UAAU,MAAM,iHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACrC,MAAM;gBACF;gBACA;YACJ;QACJ;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAChC;IAEA,IAAI,SAAS,CAAC,SAAS;QAAC;QAAO;KAAO;IACtC,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC;AAC/B"}}]
}